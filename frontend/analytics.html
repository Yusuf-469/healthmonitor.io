<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - HealthMonitor</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="dashboard-body">
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="dashboard.html" class="logo">
                    <i class="fas fa-heartbeat heartbeat-icon"></i>
                    <span class="logo-text">HealthMonitor</span>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <span class="nav-section-title">Main</span>
                    <a href="dashboard.html" class="nav-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="patients.html" class="nav-item">
                        <i class="fas fa-users"></i>
                        <span>Patients</span>
                    </a>
                    <a href="devices.html" class="nav-item">
                        <i class="fas fa-microchip"></i>
                        <span>Devices</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <span class="nav-section-title">Monitoring</span>
                    <a href="alerts.html" class="nav-item">
                        <i class="fas fa-bell"></i>
                        <span>Alerts</span>
                        <span class="badge alert-badge">3</span>
                    </a>
                    <a href="analytics.html" class="nav-item active">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <span class="nav-section-title">System</span>
                    <a href="settings.html" class="nav-item">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1>Analytics</h1>
                    </div>
                </div>
                
                <div class="header-right">
                    <select class="time-select" id="analytics-range">
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                        <option value="90d">Last 90 Days</option>
                    </select>
                    <button class="btn btn-secondary" onclick="exportAnalytics()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </header>

            <div class="dashboard-content">
                <!-- Analytics Charts -->
                <section class="charts-section reveal-scroll">
                    <div class="chart-card large">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-area"></i> Heart Rate Trends</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="heartRateChart"></canvas>
                        </div>
                    </div>
                </section>

                <section class="charts-section reveal-scroll">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-thermometer-half"></i> Temperature Trends</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="tempChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-lungs"></i> SpO2 Trends</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="spo2Chart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Health Insights -->
                <section class="insights-section reveal-scroll">
                    <div class="section-header">
                        <h3><i class="fas fa-lightbulb"></i> Health Insights</h3>
                    </div>
                    <div class="insights-grid" id="insights-grid">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script src="js/page-scripts.js"></script>
    <script>
        let isDemoMode = false;
        let charts = {};

        // Demo patient data
        const demoPatients = [
            { name: 'John Doe', color: '#6366f1' },
            { name: 'Jane Smith', color: '#10b981' },
            { name: 'Bob Johnson', color: '#f59e0b' },
            { name: 'Alice Williams', color: '#ef4444' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            isDemoMode = localStorage.getItem('isDemo') === 'true';
            initAnalyticsCharts();
            loadHealthInsights();
        });

        function getTimeLabels(range) {
            switch(range) {
                case '30d': return ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                case '90d': return ['Month 1', 'Month 2', 'Month 3'];
                default: return ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            }
        }

        function generateDemoData(baseValue, variance, range) {
            const labels = getTimeLabels(range);
            return labels.map(() => baseValue + (Math.random() * variance * 2 - variance));
        }

        function initAnalyticsCharts() {
            const range = document.getElementById('analytics-range').value || '7d';
            const labels = getTimeLabels(range);

            // Heart Rate Chart
            const hrCtx = document.getElementById('heartRateChart');
            if (hrCtx) {
                const hrDatasets = isDemoMode ? demoPatients.map(p => ({
                    label: p.name,
                    data: generateDemoData(72, 8, range),
                    borderColor: p.color,
                    tension: 0.4,
                    fill: false
                })) : [];

                charts.heartRate = new Chart(hrCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: hrDatasets.length > 0 ? hrDatasets : [{
                            label: 'No Data',
                            data: [],
                            borderColor: '#64748b',
                            borderDash: [5, 5],
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                display: hrDatasets.length > 0 || !isDemoMode
                            } 
                        },
                        scales: { y: { beginAtZero: false, min: 50, max: 100 } }
                    }
                });
            }

            // Temperature Chart
            const tempCtx = document.getElementById('tempChart');
            if (tempCtx) {
                charts.temp = new Chart(tempCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: isDemoMode ? 'Avg Temperature' : 'No Data',
                            data: isDemoMode ? generateDemoData(36.5, 0.3, range) : [],
                            borderColor: isDemoMode ? '#f59e0b' : '#64748b',
                            backgroundColor: isDemoMode ? 'rgba(245, 158, 11, 0.1)' : 'transparent',
                            fill: isDemoMode,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: isDemoMode } }
                    }
                });
            }

            // SpO2 Chart
            const spo2Ctx = document.getElementById('spo2Chart');
            if (spo2Ctx) {
                charts.spo2 = new Chart(spo2Ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: isDemoMode ? 'Avg SpO2' : 'No Data',
                            data: isDemoMode ? generateDemoData(97, 2, range) : [],
                            borderColor: isDemoMode ? '#3b82f6' : '#64748b',
                            backgroundColor: isDemoMode ? 'rgba(59, 130, 246, 0.1)' : 'transparent',
                            fill: isDemoMode,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: isDemoMode } },
                        scales: { y: { beginAtZero: false, min: 90, max: 100 } }
                    }
                });
            }

            // Update charts when range changes
            document.getElementById('analytics-range')?.addEventListener('change', (e) => {
                updateCharts(e.target.value);
            });
        }

        function updateCharts(range) {
            const labels = getTimeLabels(range);
            
            if (charts.heartRate) {
                charts.heartRate.data.labels = labels;
                if (isDemoMode) {
                    charts.heartRate.data.datasets = demoPatients.map(p => ({
                        label: p.name,
                        data: generateDemoData(72, 8, range),
                        borderColor: p.color,
                        tension: 0.4,
                        fill: false
                    }));
                }
                charts.heartRate.update();
            }
            
            if (charts.temp) {
                charts.temp.data.labels = labels;
                if (isDemoMode) {
                    charts.temp.data.datasets[0].data = generateDemoData(36.5, 0.3, range);
                }
                charts.temp.update();
            }
            
            if (charts.spo2) {
                charts.spo2.data.labels = labels;
                if (isDemoMode) {
                    charts.spo2.data.datasets[0].data = generateDemoData(97, 2, range);
                }
                charts.spo2.update();
            }
        }

        function loadHealthInsights() {
            const insightsGrid = document.getElementById('insights-grid');
            if (!insightsGrid) return;

            if (isDemoMode) {
                insightsGrid.innerHTML = `
                    <div class="insight-card">
                        <div class="insight-icon good">
                            <i class="fas fa-thumbs-up"></i>
                        </div>
                        <div class="insight-content">
                            <h4>Overall Health</h4>
                            <p>All patients show stable vital signs this week.</p>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="insight-content">
                            <h4>Attention Needed</h4>
                            <p>Some patients' SpO2 levels need monitoring.</p>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon info">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="insight-content">
                            <h4>AI Prediction</h4>
                            <p>No health risks predicted for the next 7 days.</p>
                        </div>
                    </div>
                `;
            } else {
                insightsGrid.innerHTML = `
                    <div class="insight-card">
                        <div class="insight-icon info">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="insight-content">
                            <h4>No Data Available</h4>
                            <p>Add patients and connect devices to see health analytics.</p>
                        </div>
                    </div>
                `;
            }
        }

        function exportAnalytics() {
            showToast('Generating analytics report...', 'info');
            setTimeout(() => showToast('Report downloaded!', 'success'), 2000);
        }
    <div class="toast-container" id="toast-container"></div>
    </script>
</body>
</html>
